extends ../layouts/default

include ../mixins/recipe

include ../mixins/header

block css
  link(href='/styles/site.min.css', rel='stylesheet')

  //- This file provides the default styling for the KeystoneJS Content Editor
  if user && user.canAccessKeystone
    link(href='/keystone/styles/content/editor.min.css', rel='stylesheet')

  //- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
  //- Safely remove this block if you are not targeting IE8
  //-[if lt IE 9]
    script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
    script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
  //-[endif]

block js
  //- JAVASCRIPT
  script(src='/js/recipe.js')

  if isNew
    script.
      $(document).ready(function(){
        // First coppy original value in data attribute for each false form component
        var $title = $('#recipe-title');
        var $difficulty = $('#recipe-difficulty .itemSelected');
        var $time = $('#recipe-time .set-editable');
        var $portions = $('#recipe-portions .set-editable');
        var $description = $('#recipe-description .set-editable');
        var $ingredients = $('#recipe-ingredients .set-editable');
        var $procedure = $('#recipe-procedure .set-editable');

        $title.empty();
        $time.empty();
        $portions.empty();
        $description.empty();

        // Change to editable mode
        $('body').addClass('mode-editable');
        $('.set-editable:not(.dropdown)').attr('contenteditable', true);

        $title.focus();

        // Overwrite cancell function
        $('#cancel.button-manage').off().on('click', function() {
          window.location.href ='/recetas';
        });
      });

  //- The KeystoneJS Content Editor provides support for ks-editable data attributes,
  //- which generate links to edit content for users who can access Keystone
  if user && user.canAccessKeystone
    script(src='/keystone/js/content/editor.js')

block content

  - var urlAction = '/';
  if isNew
    - urlAction = '/nueva-receta'
  else
    - urlAction = '/receta/' + data.recipe.slug

  if own
    form#recipe-edit-form(action=urlAction + '/save' method='POST' enctype='multipart/form-data')
      input#hidden-title(type='hidden' name='title')
      input#hidden-difficulty(type='hidden' name='difficulty')
      input#hidden-time(type='hidden' name='time')
      input#hidden-portions(type='hidden' name='portions')
      input#hidden-description(type='hidden' name='description')
      input(type='hidden' name='_csrf' value='#{csrftoken}')

    form#recipe-remove-form(action=urlAction + '/remove' method='POST' enctype='multipart/form-data')
      input(type='hidden' name='_csrf' value='#{csrftoken}')

  +header(data.recipe, section)

  .ui.page.grid
    #recipe-content.ui.grid.segment
      .row
        #info.ten.tablet-twelve.mobile-eight.wide.column
          .recipe-attributes

            #recipe-difficulty.dropdown.difficulty.set-editable(tabindex='1')
              - var categories = [ __('Dummy'), __('Very easy'), __('Easy'), __('Normal'), __('Difficult'), __('Very difficult') ]
              - var difficulty = 0

              if data.recipe
                - difficulty = data.recipe.difficulty

              - var category = categories[difficulty]

              .itemSelected
                .item(data-value=difficulty)
                  if difficulty <= 0
                    i.icon-chef-tenedor.icon.off
                    i.icon-chef-tenedor.icon.off
                    i.icon-chef-tenedor.icon.off
                    i.icon-chef-tenedor.icon.off
                    i.icon-chef-tenedor.icon.off
                    .span= __('Difficulty')
                  else
                    - for(var i = 0; i < 5; i++)
                        if(difficulty == 0)
                          i.icon-chef-tenedor.icon.off
                        else
                          i.icon-chef-tenedor.icon.on
                          - difficulty = difficulty - 1;
                      .span= category

              .options
                .item(data-value='1')
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  .span= __('Very easy')

                .item(data-value='2')
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  .span= __('Easy')

                .item(data-value='3')
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.off
                  i.icon-chef-tenedor.icon.off
                  .span= __('Normal')

                .item(data-value='4')
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.off
                  .span= __('Difficult')

                .item(data-value='5')
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  i.icon-chef-tenedor.icon.on
                  .span= __('Very difficult')

              i.dropdown.icon


            #recipe-time.time(tabindex='2')
              i.icon-chef-time.icon
              .editable-container
                .set-editable.one-line.for.numbers(placeholder=__('Time'))
                  if data.recipe && data.recipe.time
                      = (data.recipe.time < 60) ? data.recipe.time : (data.recipe.time / 60).toFixed(2)
              .span= __('min')


            #recipe-portions.portions(tabindex='3')
              i.icon-chef-porciones.icon
              .editable-container
                .set-editable.one-line.for.numbers(placeholder=__('Portions'))
                  if data.recipe && data.recipe.portions
                    = data.recipe.portions
              .span= __('Pers')

            .rating
              - var rating = 0 
              if data.recipe
                - rating = Math.floor(data.recipe.rating)

              - var r = rating
              - for(var x = 0; x < 5; x++)
                if(r == 0)
                  i.icon-chef-star.icon.off
                else
                  i.icon-chef-star.icon.on
                  - r = r - 1;

              .span= rating

        #actions.six.tablet-four.mobile-eight.wide.column.right.aligned
          .recipe-actions
            .favourite
              .ui.button.chef.button-yellow.switch.mini
                i.icon-chef-heart.icon.checks.chef
                | #{__('Favorite')}

            .add-menu
              .ui.button.chef.button-brick
                a= __('Add to menu')

      #recipe-description.row
        .sixteen.wide.column
          .explain
            .ui.content.set-editable(spellcheck='false', tabindex='4', placeholder=__('Description'))
              if data.recipe && data.recipe.description
                != data.recipe.description

      .row
        .sixteen.wide.column
          h2.ui.header= __('Ingredients')
          .explain
            .ui.content= __('In case that you don\'t have enough ingredients [...]')

        if data.recipe.ingredients
          #ingredients.ui.grid
            .three.column.row.computer.only
              - var array = data.recipe.ingredients.split('<p>')
              .column
                - for(var j = 1; j < array.length; j+=3)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]
                .ingredient
                  .icon-chef-cesta.checks.all
                  .span= __('Select all')
              .column
                - for(var j = 2; j < array.length; j+=3)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]
              .column
                - for(var j = 3; j < array.length; j+=3)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]

            .two.column.row.tablet.only

              - var array = data.recipe.ingredients.split('<p>')
              .column
                - for(var j = 1; j < array.length; j+=2)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]
                .ingredient
                  .icon-chef-cesta.checks.all
                  .span= __('Select all')
              .column
                - for(var j = 2; j < array.length; j+=2)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]

            .sixteen.wide.column.mobile.only
              - var array = data.recipe.ingredients.split('<p>')
              .column
                - for(var j = 1; j < array.length; j+=1)
                  .ingredient
                    .icon-chef-cesta.checks
                    .span!= array[j]
                .ingredient
                  .icon-chef-cesta.checks.all
                  .span= __('Select all')

      .sixteen.wide.column
        h2.ui.header= __('Procedure')
      #procedure.row
        .sixteen.wide.column
          #steps
            if data.recipe && data.recipe.procedure
              - var array = data.recipe.procedure.split('<p>')
              - for(var j = 1; j < array.length; j++)
                .step
                  .icon-chef-tick.checks
                  .ui.header= __('Step:') + ' ' + j
                  .ui.content.set-editable(spellcheck='false')!= array[j]

